{% extends "base.html" %}

{% block title %}Post #{{ post.id }} - Content Engine{% endblock %}

{% block content %}
<div class="post-detail">
    <div class="breadcrumb">
        <a href="/">Dashboard</a> / <a href="/posts">Posts</a> / Post #{{ post.id }}
    </div>

    <div class="post-detail-card">
        <div class="post-detail-header">
            <h2>Post #{{ post.id }}</h2>
            <span class="badge {{ post.status | status_badge_class }} large">{{ post.status.value }}</span>
        </div>

        <div class="post-detail-meta">
            <div class="meta-item">
                <strong>Platform:</strong> {{ post.platform.value }}
            </div>
            <div class="meta-item">
                <strong>Created:</strong> {{ post.created_at | format_datetime("%Y-%m-%d at %H:%M") }}
            </div>
            <div class="meta-item">
                <strong>Updated:</strong> {{ post.updated_at | format_datetime("%Y-%m-%d at %H:%M") }}
            </div>
            {% if post.scheduled_at %}
            <div class="meta-item">
                <strong>Scheduled:</strong> {{ post.scheduled_at | format_datetime("%Y-%m-%d at %H:%M") }}
            </div>
            {% endif %}
            {% if post.posted_at %}
            <div class="meta-item">
                <strong>Posted:</strong> {{ post.posted_at | format_datetime("%Y-%m-%d at %H:%M") }}
            </div>
            {% endif %}
            {% if post.external_id %}
            <div class="meta-item">
                <strong>External ID:</strong> <code>{{ post.external_id }}</code>
            </div>
            {% endif %}
            {% if post.error_message %}
            <div class="meta-item error">
                <strong>Error:</strong> {{ post.error_message }}
            </div>
            {% endif %}
        </div>

        <div class="post-detail-content">
            <h3>Content</h3>
            <div class="content-box">
                <p class="content-text">{{ post.content }}</p>
                <div class="content-stats">
                    <span>{{ post.content|length }} characters</span>
                    <span>{{ (post.content.split()|length) }} words</span>
                </div>
            </div>
        </div>

        <div class="post-detail-actions">
            <a href="/posts" class="btn-secondary">â† Back to Posts</a>

            {% if request.state.is_authenticated %}
            <!-- Authenticated Mode: Functional buttons -->
            <div class="action-buttons">
                {% if post.status.value == 'draft' %}
                <button class="btn-primary" hx-post="/posts/{{ post.id }}/approve" hx-swap="outerHTML">
                    âœ… Approve & Post
                </button>
                <button class="btn-secondary" hx-post="/posts/{{ post.id }}/schedule" hx-swap="outerHTML">
                    ğŸ“… Schedule
                </button>
                {% elif post.status.value == 'scheduled' %}
                <button class="btn-primary" hx-post="/posts/{{ post.id }}/post-now" hx-swap="outerHTML">
                    ğŸš€ Post Now
                </button>
                <button class="btn-secondary" hx-post="/posts/{{ post.id }}/cancel-schedule" hx-swap="outerHTML">
                    â¸ï¸ Cancel Schedule
                </button>
                {% elif post.status.value == 'posted' and post.platform.value == 'linkedin' %}
                <a href="https://www.linkedin.com/feed/" target="_blank" class="btn-primary">View on LinkedIn â†’</a>
                {% endif %}
                <button class="btn-secondary" hx-get="/posts/{{ post.id }}/edit" hx-swap="innerHTML" hx-target=".post-detail">
                    âœï¸ Edit
                </button>
                <button class="btn-danger" hx-delete="/posts/{{ post.id }}" hx-confirm="Are you sure you want to delete this post?" hx-swap="outerHTML">
                    ğŸ—‘ï¸ Delete
                </button>
            </div>
            {% else %}
            <!-- Demo Mode: Ephemeral buttons (will add JS handlers in Phase 3) -->
            <div class="demo-actions">
                {% if post.status.value == 'draft' %}
                <button class="btn-demo primary" data-action="approve" data-post-id="{{ post.id }}"
                        title="ğŸ‘‹ Demo mode! Sign in with LinkedIn to approve and post.">
                    âœ… Approve & Post
                </button>
                <button class="btn-demo" data-action="schedule" data-post-id="{{ post.id }}"
                        title="ğŸ‘‹ Demo mode! Sign in with LinkedIn to schedule posts.">
                    ğŸ“… Schedule
                </button>
                {% elif post.status.value == 'scheduled' %}
                <button class="btn-demo primary" data-action="post-now" data-post-id="{{ post.id }}"
                        title="ğŸ‘‹ Demo mode! Sign in with LinkedIn to post immediately.">
                    ğŸš€ Post Now
                </button>
                <button class="btn-demo" data-action="cancel-schedule" data-post-id="{{ post.id }}"
                        title="ğŸ‘‹ Demo mode! Sign in with LinkedIn to manage scheduled posts.">
                    â¸ï¸ Cancel Schedule
                </button>
                {% elif post.status.value == 'posted' and post.platform.value == 'linkedin' %}
                <a href="https://www.linkedin.com/feed/" target="_blank" class="btn-primary">View on LinkedIn â†’</a>
                {% endif %}
                <button class="btn-demo" data-action="edit" data-post-id="{{ post.id }}"
                        title="ğŸ‘‹ Demo mode! Sign in with LinkedIn to edit posts.">
                    âœï¸ Edit
                </button>
                <button class="btn-demo danger" data-action="delete" data-post-id="{{ post.id }}"
                        title="ğŸ‘‹ Demo mode! Sign in with LinkedIn to delete posts.">
                    ğŸ—‘ï¸ Delete
                </button>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
